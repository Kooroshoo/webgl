<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebGL2 Colored Triangle</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      border: 1px solid #fff;
    }
  </style>
</head>
<body>
  <canvas id="glCanvas" width="800" height="600"></canvas>
  <script>
    const canvas = document.getElementById('glCanvas');
    const gl = canvas.getContext('webgl2');
    if (!gl) {
      alert('WebGL2 not supported');
    }

    // Basic vertex and fragment shaders
    const vsSource = `#version 300 es
    layout(location = 0) in vec2 a_position;
    layout(location = 1) in vec3 a_color;

    out vec3 v_color;

    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
      v_color = a_color;
    }`;

    const fsSource = `#version 300 es
    precision mediump float;

    in vec3 v_color;
    out vec4 outColor;

    void main() {
      outColor = vec4(v_color, 1.0);
    }`;

    function compileShader(type, source) {
      const shader = gl.createShader(type);
      gl.shaderSource(shader, source);
      gl.compileShader(shader);
      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        console.error(gl.getShaderInfoLog(shader));
        gl.deleteShader(shader);
        return null;
      }
      return shader;
    }

    const vs = compileShader(gl.VERTEX_SHADER, vsSource);
    const fs = compileShader(gl.FRAGMENT_SHADER, fsSource);

    const program = gl.createProgram();
    gl.attachShader(program, vs);
    gl.attachShader(program, fs);
    gl.linkProgram(program);
    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
      console.error(gl.getProgramInfoLog(program));
    }

    // Add Vertex Data (position + color)
    const triangleData = new Float32Array([
      //x, y, r, g, b
      0.0,  0.5,   1.0, 0.0, 0.0,  // Top (red)
      -0.5, -0.5,  0.0, 1.0, 0.0,  // Left (green)
      0.5, -0.5,  0.0, 0.0, 1.0   // Right (blue)
    ]);

    // Create VAO and VBO  
    const vao = gl.createVertexArray();     // Create a Vertex Array Object (VAO) to store all the vertex attribute state
    const vbo = gl.createBuffer();          // Create a Vertex Buffer Object (VBO) to hold vertex data in GPU memory
    gl.bindVertexArray(vao);                // Bind the VAO so we record all subsequent vertex attribute calls here
    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);    // Bind the VBO as the current ARRAY_BUFFER (target for vertex data)

    gl.bufferData(gl.ARRAY_BUFFER, triangleData, gl.STATIC_DRAW);   // Upload the vertex data (positions + colors) to the GPU buffer

    // Define the total byte size of a single vertex (stride)
    const stride = 5 * Float32Array.BYTES_PER_ELEMENT;              // Each vertex has 5 floats: 2 for position + 3 for color

    gl.enableVertexAttribArray(0);                                  // Enable vertex attribute array for 'a_position' at location 0
    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, stride, 0);       // Describe how to pull out the position data from the buffer: location 0, 2 components per vertex (x, y), type FLOAT, not normalized, stride bytes between vertices, offset 0 bytes (start of vertex data)

    gl.enableVertexAttribArray(1);                                                              // Enable vertex attribute array for 'a_color' at location 1
    gl.vertexAttribPointer(1, 3, gl.FLOAT, false, stride, 2 * Float32Array.BYTES_PER_ELEMENT);  // Describe how to pull out the color data from the buffer: location 1, 3 components per vertex (r, g, b), type FLOAT, not normalized, stride bytes between vertices, offset bytes to color data = 2 floats (position) * bytes per float

    // Unbind VAO and VBO to avoid accidentally modifying them later
    gl.bindVertexArray(null);
    gl.bindBuffer(gl.ARRAY_BUFFER, null);
    
    gl.viewport(0, 0, canvas.width, canvas.height);             // Set viewport size to match canvas dimensions
    gl.clearColor(0.1, 0.1, 0.1, 1);                            // Set the clear color (dark gray background)
    gl.clear(gl.COLOR_BUFFER_BIT);                              // Clear the canvas with the clear color
    gl.useProgram(program);                                     // Use the shader program
    gl.bindVertexArray(vao);                                    // Bind the VAO (which has all vertex attribute states stored)
    gl.drawArrays(gl.TRIANGLES, 0, 3);                          // Draw the triangle (3 vertices, using TRIANGLES primitive)
    gl.bindVertexArray(null);                                   // Unbind VAO after drawing

  </script>
</body>
</html>
